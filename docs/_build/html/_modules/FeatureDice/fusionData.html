<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FeatureDice.fusionData &mdash; FeatureDice 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            FeatureDice
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pages/Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/GettingStarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/methods/ImputationMethods.html">Imputation Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/methods/NormalizationMethods.html">Normalization Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/methods/FusionMethods.html">Fusion Methods</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">FeatureDice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FeatureDice</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">FeatureDice.fusionData</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for FeatureDice.fusionData</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span><span class="p">,</span> <span class="n">SimpleImputer</span>
<span class="c1"># Import the necessary modules</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">normalize</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PowerTransformer</span><span class="p">,</span> <span class="n">QuantileTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">RobustScaler</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span><span class="p">,</span> <span class="n">IterativeImputer</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span><span class="p">,</span> <span class="n">FastICA</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_decomposition</span> <span class="kn">import</span> <span class="n">PLSRegression</span><span class="p">,</span> <span class="n">CCA</span><span class="p">,</span> <span class="n">PLSCanonical</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">IncrementalPCA</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_decomposition</span> <span class="kn">import</span> <span class="n">CCA</span>

<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">KernelPCA</span>
<span class="kn">from</span> <span class="nn">sklearn.kernel_approximation</span> <span class="kn">import</span> <span class="n">RBFSampler</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">Isomap</span><span class="p">,</span> <span class="n">TSNE</span><span class="p">,</span> <span class="n">SpectralEmbedding</span><span class="p">,</span> <span class="n">LocallyLinearEmbedding</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">normalize</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">FeatureDice.plot_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">FeatureDice.preprocess_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">FeatureDice.saving_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">FeatureDice.analyse_data</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">tensorly</span> <span class="k">as</span> <span class="nn">tl</span>
<span class="kn">from</span> <span class="nn">tensorly.decomposition</span> <span class="kn">import</span> <span class="n">parafac</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">f_regression</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">to_rgba</span>

<span class="c1"># Import the necessary modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">balanced_accuracy_score</span><span class="p">,</span> <span class="n">matthews_corrcoef</span><span class="p">,</span> <span class="n">cohen_kappa_score</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">ElasticNet</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span><span class="p">,</span> <span class="n">AdaBoostRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process</span> <span class="kn">import</span> <span class="n">GaussianProcessRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.kernel_ridge</span> <span class="kn">import</span> <span class="n">KernelRidge</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1">#########################</span>

<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Patch</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<div class="viewcode-block" id="fusionData">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData">[docs]</a>
<span class="k">class</span> <span class="nc">fusionData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for handling data and performing fusion tasks.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        - data_paths (list): List of file paths containing the data.</span>
<span class="sd">        - id_column (str): Name of the column representing unique identifiers.</span>
<span class="sd">        - dataframes (dict): Dictionary containing processed dataframes.</span>
<span class="sd">        - prediction_label: Placeholder for prediction labels.</span>
<span class="sd">        - fusedData: Placeholder for fused data.</span>
<span class="sd">        - pls_model: Placeholder for the PLS model.</span>
<span class="sd">        - Accuracy_metrics: Placeholder for accuracy metrics.</span>
<span class="sd">        - train_dataframes: Placeholder for training dataframes.</span>
<span class="sd">        - test_dataframes: Placeholder for testing dataframes.</span>
<span class="sd">        - train_label: Placeholder for training labels.</span>
<span class="sd">        - test_label: Placeholder for testing labels.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_paths</span><span class="p">,</span> <span class="n">id_column</span> <span class="o">=</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">prediction_label_column</span> <span class="o">=</span> <span class="s2">&quot;prediction_label&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Initialize fusionData object with provided data paths, ID column name,</span>
<span class="sd">        and prediction label column name.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_paths (list): List of file paths containing the data.</span>
<span class="sd">            id_column (str, optional): Name of the column representing unique identifiers.</span>
<span class="sd">                Defaults to &quot;ID&quot;.</span>
<span class="sd">            prediction_label_column (str, optional): Name of the column containing prediction labels.</span>
<span class="sd">                Defaults to &quot;prediction_label&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_paths</span> <span class="o">=</span> <span class="n">data_paths</span>
        <span class="n">loaded_data_dict</span> <span class="o">=</span> <span class="n">clear_and_process_data</span><span class="p">(</span><span class="n">data_paths</span><span class="p">,</span> <span class="n">id_column</span><span class="p">,</span> <span class="n">prediction_label_column</span><span class="p">)</span>
        <span class="c1">#check_missing_values(loaded_data_dict)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span> <span class="o">=</span> <span class="n">loaded_data_dict</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes_transformed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">olddataframes</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">top_features</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusedData</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaling_done</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pls_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Accuracy_metrics</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataframes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_dataframes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span> <span class="o">=</span> <span class="kc">None</span>

    
    
<div class="viewcode-block" id="fusionData.ShowMissingValues">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.ShowMissingValues">[docs]</a>
    <span class="k">def</span> <span class="nf">ShowMissingValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints missing values fusion data inside the fusionData object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
        <span class="c1"># Iterate through the dictionary and print missing DataFrame </span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">missing_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataframe name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">Missing values: </span><span class="si">{</span><span class="n">missing_values</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="fusionData.show_info">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.show_info">[docs]</a>
    <span class="k">def</span> <span class="nf">show_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarize fusion data inside the fusionData object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">show_dataframe_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="fusionData.plot_info">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.plot_info">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">about</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Generate plots based on the specified topic.</span>

<span class="sd">        This method supports two types of plots:</span>
<span class="sd">           - &#39;missing_values&#39;: will generate a plot showing the missing values in the dataframes.</span>
<span class="sd">           - &#39;normality&#39;: will generate a bar plot to check the normality of the data in the dataframes.</span>

<span class="sd">        :param about: The topic for the plot. Must be either &#39;missing_values&#39; or &#39;normality&#39;.</span>
<span class="sd">        :type about: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">about</span> <span class="o">==</span> <span class="s2">&quot;missing_values&quot;</span><span class="p">:</span>
            <span class="n">plot_missing_values</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">about</span> <span class="o">==</span> <span class="s2">&quot;normality&quot;</span><span class="p">:</span>
            <span class="n">barplot_normality_check</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please select a valid plot type: &#39;missing_values&#39; or &#39;normality&#39;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="fusionData.keep_common_samples">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.keep_common_samples">[docs]</a>
    <span class="k">def</span> <span class="nf">keep_common_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keep only the common samples or rows using the index column in dataframes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create an empty set to store the common indices</span>
        <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
        <span class="c1"># Loop through the df_dict</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Get the index of the current dataframe and convert it to a set</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># Update the common indices set with the intersection of the current index</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">common_indices</span><span class="p">:</span>
                <span class="n">common_indices</span> <span class="o">=</span> <span class="n">index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">common_indices</span> <span class="o">=</span> <span class="n">common_indices</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Create an empty dictionary to store the filtered dataframes</span>
        <span class="n">filtered_df_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Loop through the df_dict again</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Filter the dataframe by the common indices and store it in the filtered_df_dict</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">common_indices</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prediction_label</span> <span class="o">=</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;prediction_label&#39;</span><span class="p">]</span>
            <span class="n">filtered_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;prediction_label&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="n">filtered_df_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df</span>
            
            


        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span> <span class="o">=</span> <span class="n">filtered_df_dict</span></div>



        
<div class="viewcode-block" id="fusionData.remove_empty_features">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.remove_empty_features">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_empty_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove columns with more than a certain percentage of missing values from dataframes.</span>

<span class="sd">        :param threshold: The percentage threshold of missing values to drop a column. It should be between 0 and 100.</span>
<span class="sd">        :type threshold: float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Calculate the minimum count of non-null values required </span>
            <span class="n">min_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(((</span><span class="mi">100</span> <span class="o">-</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Drop columns with insufficient non-null values</span>
            <span class="n">df_cleaned</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">min_count</span><span class="p">)</span>
            <span class="n">dataframes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cleaned</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span> <span class="o">=</span> <span class="n">dataframes</span></div>


<div class="viewcode-block" id="fusionData.ImputeData">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.ImputeData">[docs]</a>
    <span class="k">def</span> <span class="nf">ImputeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Impute missing data in the dataframes.</span>

<span class="sd">        This method supports five types of imputation methods: </span>
<span class="sd">           - &#39;knn&#39; will use the K-Nearest Neighbors approach to impute missing values.</span>
<span class="sd">           - &#39;mean&#39; will use the mean of each column to fill missing values.</span>
<span class="sd">           - &#39;most_frequent&#39; will use the mode of each column to fill missing values.</span>
<span class="sd">           - &#39;median&#39; will use the median of each column to fill missing values.</span>
<span class="sd">           - &#39;interpolate&#39; will use the Interpolation method to fill missing values.</span>

<span class="sd">        :param method: The imputation method to use. Options are &quot;knn&quot;, &quot;mean&quot;, &quot;mode&quot;, &quot;median&quot;, and &quot;interpolate&quot;.</span>
<span class="sd">        :type method: str, optional</span>

<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">missing_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;knn&quot;</span><span class="p">:</span>
                    <span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">df_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;most_frequent&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">]:</span>
                    <span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                    <span class="n">df_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">df_imputed</span> <span class="o">=</span> <span class="n">df</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please select a valid imputation method: &#39;knn&#39;, &#39;mean&#39;, &#39;most_frequent&#39;, &#39;median&#39;, or &#39;interpolate&#39;&quot;</span><span class="p">)</span>
                <span class="n">dataframes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_imputed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span> <span class="o">=</span> <span class="n">dataframes</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Imputation Done&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="fusionData.scale_dataframes">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.scale_dataframes">[docs]</a>
    <span class="k">def</span> <span class="nf">scale_dataframes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaling_type</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Scale the dataFrame based on the specified scale type.</span>

<span class="sd">        The scaling methods are as follows:</span>
<span class="sd">            - &#39;standardize&#39; Applies the standard scaler method to each column of the dataframe. This method transforms the data to have a mean of zero and a standard deviation of one. It is useful for reducing the effect of outliers and making the data more normally distributed.</span>
<span class="sd">            - &#39;minmax&#39; Applies the min-max scaler method to each column of the dataframe. This method transforms the data to have a minimum value of zero and a maximum value of one. It is useful for making the data more comparable and preserving the original distribution.</span>
<span class="sd">            - &#39;robust&#39; Applies the robust scaler method to each column of the dataframe. This method transforms the data using the median and the interquartile range. It is useful for reducing the effect of outliers and making the data more robust to noise.</span>
<span class="sd">            - &#39;pareto&#39; Applies the pareto scaling method to each column of the dataframe. This method divides each element by the square root of the standard deviation of the column. It is useful for making the data more homogeneous and reducing the effect of skewness.</span>
<span class="sd">        </span>
<span class="sd">        :param scaling_type: The type of scaling to be applied. It can be one of these: &#39;standardize&#39;, &#39;minmax&#39;, &#39;robust&#39;, or &#39;pareto&#39;.</span>
<span class="sd">        :type scaling_type: str</span>
<span class="sd">        :param kwargs: Additional parameters for specific scaling methods.</span>
<span class="sd">        :type kwargs: dict</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>


        <span class="c1"># Loop through the df_dict</span>
        <span class="k">for</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Apply the scaling type to the dataframe</span>
            <span class="k">if</span> <span class="n">scaling_type</span> <span class="o">==</span> <span class="s1">&#39;standardize&#39;</span><span class="p">:</span>
                <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
                <span class="n">scaled_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">scaling_type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
                <span class="n">scaled_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">scaling_type</span> <span class="o">==</span> <span class="s1">&#39;robust&#39;</span><span class="p">:</span>
                <span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
                <span class="n">scaled_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">scaling_type</span> <span class="o">==</span> <span class="s1">&#39;pareto&#39;</span><span class="p">:</span>
                <span class="n">scaled_df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Unsupported scaling type: </span><span class="si">{</span><span class="n">scaling_type</span><span class="si">}</span><span class="s2"> </span>
<span class="s2">                                    possible values are &#39;standardize&#39;, &#39;minmax&#39;, &#39;robust&#39;, or &#39;pareto&#39; &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="c1"># Return the scaled dataframe</span>
            <span class="n">dataframes</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span> <span class="o">=</span> <span class="n">dataframes</span></div>


<div class="viewcode-block" id="fusionData.normalize_dataframes">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.normalize_dataframes">[docs]</a>
    <span class="k">def</span> <span class="nf">normalize_dataframes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">normalization_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        This method supports four types of normalization methods:</span>
<span class="sd">            - &#39;constant sum&#39; normalization. The default sum is 1, which can  specified using the &#39;sum&#39; keyword argument in kwargs. It is a method used to normalize data such that the sum of values for each observation remains constant. It ensures that the relative contributions of individual features to the total sum are compared rather than the absolute values. This normalization technique is beneficial for comparing samples with different total magnitudes but similar distributions. Mathematically, each observation is normalized by dividing it by the sum of its values, then multiplying by a constant factor to achieve the desired sum.</span>
<span class="sd">            - &#39;L1&#39; normalization (Lasso Norm or Manhattan Norm): Also known as Lasso Norm or Manhattan Norm. Each observation vector is rescaled by dividing each element by the L1-norm of the vector.. L1-norm of a vector is the sum of the absolute values of its components. Mathematically, for a vector x, L1 normalization is given by: L1-Norm = ∑|x_i|. After L1 normalization, the sum of the absolute values of the elements in each vector becomes 1. Widely used in machine learning tasks such as Lasso regression to encourage sparsity in the solution.</span>
<span class="sd">            - &#39;L2&#39; normalization (Ridge Norm or Euclidean Norm): Also known as Ridge Norm or Euclidean Norm.Each observation vector is rescaled by dividing each element by the L2-norm of the vector. L2-norm of a vector is the square root of the sum of the squares of its components. Mathematically, for a vector x, L2 normalization is given by: L2-Norm = √∑x_i^2. After L2 normalization, the Euclidean distance (or the magnitude) of each vector becomes 1. Widely used in various machine learning algorithms such as logistic regression, support vector machines, and neural networks.</span>
<span class="sd">            - &#39;max&#39; normalization (Maximum Normalization): Scales each feature in the dataset by dividing it by the maximum absolute value of that feature across all observations. Ensures that each feature&#39;s values are within the range [-1, 1] or [0, 1] depending on whether negative values are present or not. Useful when the ranges of features in the dataset are significantly different, preventing certain features from dominating the learning process due to their larger scales. Commonly used in neural networks and deep learning models as part of the data preprocessing step.</span>

<span class="sd">        Normalize dataframes using different types of normalization.</span>

<span class="sd">        :param normalization_type: The type of normalization to apply. It can be one of these: &#39;constant_sum&#39;, &#39;L1&#39;, &#39;L2&#39;, or &#39;max&#39;.        </span>
<span class="sd">        :type normalization_type: str</span>
<span class="sd">        :param kwargs: Additional arguments for some normalization types.</span>
<span class="sd">        :type kwargs: dict</span>
<span class="sd">        :raises ValueError: If the provided method is not &#39;constant_sum&#39;, &#39;L1&#39; ,&#39;L2&#39; or &#39;max</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c1"># Create an empty dictionary to store the normalized dataframes</span>
        <span class="n">normalized_df_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>

        <span class="c1"># Loop through the df_dict</span>
        <span class="k">for</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Apply the normalization type to the dataframe</span>
            <span class="k">if</span> <span class="n">normalization_type</span> <span class="o">==</span> <span class="s1">&#39;constant_sum&#39;</span><span class="p">:</span>
                <span class="n">constant_sum</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">normalized_df</span> <span class="o">=</span> <span class="n">normalize_to_constant_sum</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">constant_sum</span><span class="o">=</span><span class="n">constant_sum</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">normalization_type</span> <span class="o">==</span> <span class="s1">&#39;L1&#39;</span><span class="p">:</span>
                <span class="n">normalized_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">normalization_type</span> <span class="o">==</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span>
                <span class="n">normalized_df</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">normalization_type</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                <span class="n">normalized_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Unsupported normalization type: </span><span class="si">{</span><span class="n">normalization_type</span><span class="si">}</span><span class="s2"> </span>
<span class="s2">                                    possible values are &#39;constant_sum&#39;, &#39;L1&#39; ,&#39;L2&#39; and &#39;max&#39;   &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="c1"># Store the normalized dataframe in the normalized_df_dict</span>
            <span class="n">dataframes</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span> <span class="o">=</span> <span class="n">dataframes</span></div>


<div class="viewcode-block" id="fusionData.transform_dataframes">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.transform_dataframes">[docs]</a>
    <span class="k">def</span> <span class="nf">transform_dataframes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        The transformation methods are as follows:</span>
<span class="sd">            - &#39;cubicroot&#39;: Applies the cube root function to each element of the dataframe.</span>
<span class="sd">            - &#39;log10&#39;: Applies the base 10 logarithm function to each element of the dataframe.</span>
<span class="sd">            - &#39;log&#39;: Applies the natural logarithm function to each element of the dataframe.</span>
<span class="sd">            - &#39;log2&#39;: Applies the base 2 logarithm function to each element of the dataframe.</span>
<span class="sd">            - &#39;sqrt&#39;: Applies the square root function to each element of the dataframe.</span>
<span class="sd">            - &#39;powertransformer&#39;: Applies the power transformer method to each column of the dataframe. This method transforms the data to make it more Gaussian-like. It supports two methods: &#39;yeo-johnson&#39; and &#39;box-cox&#39;. The default method is &#39;yeo-johnson&#39;, which can handle both positive and negative values. The &#39;box-cox&#39; method can only handle positive values. The method can be specified using the &#39;method&#39; keyword argument in kwargs.</span>
<span class="sd">            - &#39;quantiletransformer&#39;: Applies the quantile transformer method to each column of the dataframe. This method transforms the data to follow a uniform or a normal distribution. It supports two output distributions: &#39;uniform&#39; and &#39;normal&#39;. The default distribution is &#39;uniform&#39;. The distribution can be specified using the &#39;output_distribution&#39; keyword argument in kwargs.</span>

<span class="sd">        Transform dataframes using different types of mathematical transformations.</span>

<span class="sd">        :param transformation_type: The type of transformation to apply. It can be one of these: &#39;cubicroot&#39;, &#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;, &#39;sqrt&#39;, &#39;powertransformer&#39;, or &#39;quantiletransformer&#39;.</span>
<span class="sd">        :type transformation_type: str</span>
<span class="sd">        :param kwargs: Additional arguments for some transformation types.</span>
<span class="sd">        :type kwargs: dict</span>


<span class="sd">        :raises: ValueError if the transformation_type is not one of the valid options.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>

        <span class="c1"># Loop through the df_dict</span>
        <span class="k">for</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Apply the normalization type to the dataframe</span>
            <span class="c1"># Apply the transformation type to the dataframe</span>
            <span class="k">if</span> <span class="n">transformation_type</span> <span class="o">==</span> <span class="s1">&#39;cubicroot&#39;</span><span class="p">:</span>
                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">transformation_type</span> <span class="o">==</span> <span class="s1">&#39;log10&#39;</span><span class="p">:</span>
                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">transformation_type</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">transformation_type</span> <span class="o">==</span> <span class="s1">&#39;log2&#39;</span><span class="p">:</span>
                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">transformation_type</span> <span class="o">==</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">:</span>
                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">transformation_type</span> <span class="o">==</span> <span class="s1">&#39;powertransformer&#39;</span><span class="p">:</span>
                <span class="c1"># Create a scaler object with the specified method</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;yeo-johnson&#39;</span><span class="p">)</span>
                <span class="n">scaler</span> <span class="o">=</span> <span class="n">PowerTransformer</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

                <span class="c1"># Transform the dataframe and convert the result to a dataframe</span>
                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">transformation_type</span> <span class="o">==</span> <span class="s1">&#39;quantiletransformer&#39;</span><span class="p">:</span>
                <span class="c1"># Create a scaler object with the specified output distribution</span>
                <span class="n">output_distribution</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output_distribution&#39;</span><span class="p">,</span> <span class="s1">&#39;uniform&#39;</span><span class="p">)</span>
                <span class="n">scaler</span> <span class="o">=</span> <span class="n">QuantileTransformer</span><span class="p">(</span><span class="n">output_distribution</span><span class="o">=</span><span class="n">output_distribution</span><span class="p">)</span>

                <span class="c1"># Transform the dataframe and convert the result to a dataframe</span>
                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Unsupported transformation type: </span><span class="si">{</span><span class="n">transformation_type</span><span class="si">}</span><span class="s2"> possible values are </span>
<span class="s2">                                    &#39;cubicroot&#39;, &#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;, &#39;sqrt&#39;, &#39;powertransformer&#39;, or &#39;quantiletransformer&#39;&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="c1"># Return the transformed dataframe</span>
            
            <span class="n">dataframes</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span> <span class="o">=</span> <span class="n">dataframes</span></div>





<div class="viewcode-block" id="fusionData.fuseFeatures">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.fuseFeatures">[docs]</a>
    <span class="k">def</span> <span class="nf">fuseFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        The fusion methods are as follows:</span>
<span class="sd">           - &#39;pca&#39;: Principal Component Analysis, a linear dimensionality reduction technique that projects the data onto a lower-dimensional subspace that maximizes the variance.</span>
<span class="sd">           - &#39;ica&#39;: Independent Component Analysis, a linear dimensionality reduction technique that separates the data into independent sources based on the assumption of statistical independence.</span>
<span class="sd">           - &#39;ipca&#39;: Incremental Principal Component Analysis, a variant of PCA that allows for online updates of the components without requiring access to the entire dataset.</span>
<span class="sd">           - &#39;cca&#39;: Canonical Correlation Analysis, a linear dimensionality reduction technique that finds the linear combinations of two sets of variables that are maximally correlated with each other.</span>
<span class="sd">           - &#39;tsne&#39;: t-distributed Stochastic Neighbor Embedding, a non-linear dimensionality reduction technique that preserves the local structure of the data by embedding it in a lower-dimensional space with a probability distribution that matches the pairwise distances in the original space.</span>
<span class="sd">           - &#39;kpca&#39;: Kernel Principal Component Analysis, a non-linear extension of PCA that uses a kernel function to map the data into a higher-dimensional feature space where it is linearly separable.</span>
<span class="sd">           - &#39;rks&#39;: Random Kitchen Sinks, a non-linear dimensionality reduction technique that uses random projections to approximate a kernel function and map the data into a lower-dimensional feature space.</span>
<span class="sd">           - &#39;SEM&#39;: Structural Equation Modeling, a statistical technique that tests the causal relationships between multiple variables using a combination of regression and factor analysis.</span>
<span class="sd">           - &#39;isomap&#39;: Isometric Mapping, a non-linear dimensionality reduction technique that preserves the global structure of the data by embedding it in a lower-dimensional space with a geodesic distance that approximates the shortest path between points in the original space.</span>
<span class="sd">           - &#39;lle&#39;: Locally Linear Embedding, a non-linear dimensionality reduction technique that preserves the local structure of the data by reconstructing each point as a linear combination of its neighbors and embedding it in a lower-dimensional space that minimizes the reconstruction error.</span>
<span class="sd">           - &#39;autoencoder&#39;: A type of neural network that learns to encode the input data into a lower-dimensional latent representation and decode it back to the original data, minimizing the reconstruction error.</span>
<span class="sd">           - &#39;plsda&#39;: Partial Least Squares Discriminant Analysis, a supervised dimensionality reduction technique that finds the linear combinations of the features that best explain both the variance and the correlation with the target variable.</span>
<span class="sd">           - &#39;tensordecompose&#39;: Tensor Decomposition, a technique that decomposes a multi-dimensional array (tensor) into a set of lower-dimensional arrays (factors) that capture the latent structure and interactions of the data.</span>
<span class="sd">        </span>
<span class="sd">        Fuse the features of multiple dataframes using different methods.</span>

<span class="sd">        :param n_components: The number of components use for the fusion.</span>
<span class="sd">        :type n_components: int</span>
<span class="sd">        :param method: The method to use for the fusion. It can be one of these: &#39;pca&#39;, &#39;ica&#39;, &#39;ipca&#39;, &#39;cca&#39;, &#39;tsne&#39;, &#39;kpca&#39;, &#39;rks&#39;, &#39;SEM&#39;, &#39;isomap&#39;, &#39;lle&#39;, &#39;autoencoder&#39;, &#39;plsda&#39;, or &#39;tensordecompose&#39;.</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :param kwargs: Additional arguments for specific fusion methods.</span>
<span class="sd">        :type kwargs: dict</span>

<span class="sd">        :raises: ValueError if the method is not one of the valid options.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Iterate through the dictionary and fusion DataFrame</span>
        <span class="c1"># train data fusion</span>
        <span class="n">dataframes1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_linear1</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cca&#39;</span><span class="p">]:</span>
            <span class="n">all_combinations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_combinations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">all_fused</span> <span class="o">=</span><span class="p">[]</span>
            <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">df_listn</span> <span class="ow">in</span> <span class="n">all_combinations</span><span class="p">:</span>
                <span class="n">fused_df_t</span> <span class="o">=</span> <span class="n">ccafuse</span><span class="p">(</span><span class="n">df_listn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df_listn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">n_components</span><span class="p">)</span>
                <span class="n">all_fused</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fused_df_t</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_fused</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="s1">&#39;kpca&#39;</span><span class="p">,</span> <span class="s1">&#39;rks&#39;</span><span class="p">,</span> <span class="s1">&#39;SEM&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear1</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;isomap&#39;</span><span class="p">,</span> <span class="s1">&#39;lle&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear2</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1">#print(&quot;done&quot;)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;autoencoder&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear3</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                                                <span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> 
                                                <span class="n">hidden_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


        <span class="n">prediction_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_label</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;plsda&#39;</span><span class="p">]:</span>
            <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span><span class="p">,</span> <span class="n">pls_canonical</span> <span class="o">=</span> <span class="n">apply_analysis_linear2</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">prediction_label</span><span class="p">,</span> <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pls_model</span> <span class="o">=</span> <span class="n">pls_canonical</span>

        <span class="c1">######################</span>
            
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tensordecompose&#39;</span><span class="p">]:</span>
            <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df_list_selected</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">top_features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">:</span>
                <span class="n">num_features</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">fs</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">num_features</span><span class="p">)</span>
                <span class="c1">#print(df)</span>
                <span class="n">X_selected</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prediction_label</span><span class="p">)</span>
                <span class="c1"># print(fs.get_feature_names_out())</span>
                <span class="c1">#print(df.columns)</span>
                <span class="n">top_feature</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>
                <span class="n">top_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top_feature</span><span class="p">)</span>
                <span class="n">df_list_selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">top_feature</span><span class="p">])</span>
            <span class="n">all_selected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_list_selected</span><span class="p">)</span>
            <span class="n">fused_df</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear4</span><span class="p">(</span><span class="n">all_selected</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                <span class="n">tol</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fused_df</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;TD</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fused_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_features</span> <span class="o">=</span> <span class="n">top_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusedData</span> <span class="o">=</span> <span class="n">fused_df1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data is fused. fuseiondata.fusedData &quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="fusionData.fuseFeaturesTrain">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.fuseFeaturesTrain">[docs]</a>
    <span class="k">def</span> <span class="nf">fuseFeaturesTrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># The rest of the code is unchanged</span>

        <span class="c1"># Iterate through the dictionary and fusion DataFrame</span>
        <span class="c1"># train data fusion</span>
        <span class="n">dataframes1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_dataframes</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_linear1</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cca&#39;</span><span class="p">]:</span>
            <span class="n">all_combinations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_combinations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">all_fused</span> <span class="o">=</span><span class="p">[]</span>
            <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">df_listn</span> <span class="ow">in</span> <span class="n">all_combinations</span><span class="p">:</span>
                <span class="n">fused_df_t</span> <span class="o">=</span> <span class="n">ccafuse</span><span class="p">(</span><span class="n">df_listn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df_listn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">n_components</span><span class="p">)</span>
                <span class="n">all_fused</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fused_df_t</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_fused</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="s1">&#39;kpca&#39;</span><span class="p">,</span> <span class="s1">&#39;rks&#39;</span><span class="p">,</span> <span class="s1">&#39;SEM&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear1</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;isomap&#39;</span><span class="p">,</span> <span class="s1">&#39;lle&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear2</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1">#print(&quot;done&quot;)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;autoencoder&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear3</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                                                <span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> 
                                                <span class="n">hidden_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


        <span class="n">prediction_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;plsda&#39;</span><span class="p">]:</span>
            <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span><span class="p">,</span> <span class="n">pls_canonical</span> <span class="o">=</span> <span class="n">apply_analysis_linear2</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span>
                                                            <span class="n">prediction_label</span><span class="p">,</span>
                                                            <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                            <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training_pls_model</span> <span class="o">=</span> <span class="n">pls_canonical</span>

        <span class="c1">######################</span>
            
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tensordecompose&#39;</span><span class="p">]:</span>
            <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df_list_selected</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">top_features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">:</span>
                <span class="n">num_features</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">fs</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">num_features</span><span class="p">)</span>
                <span class="c1">#print(df)</span>
                <span class="n">X_selected</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prediction_label</span><span class="p">)</span>
                <span class="c1"># print(fs.get_feature_names_out())</span>
                <span class="c1">#print(df.columns)</span>
                <span class="n">top_feature</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>
                <span class="n">top_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top_feature</span><span class="p">)</span>
                <span class="n">df_list_selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">top_feature</span><span class="p">])</span>
            <span class="n">all_selected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_list_selected</span><span class="p">)</span>
            <span class="n">fused_df</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear4</span><span class="p">(</span><span class="n">all_selected</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                <span class="n">tol</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fused_df</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;TD</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fused_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_features_train</span> <span class="o">=</span> <span class="n">top_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_train</span> <span class="o">=</span> <span class="n">fused_df1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training data is fused.&quot;</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="fusionData.fuseFeaturesTest">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.fuseFeaturesTest">[docs]</a>
    <span class="k">def</span> <span class="nf">fuseFeaturesTest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Iterate through the dictionary and fusion DataFrame</span>
        <span class="c1"># train data fusion</span>
        <span class="n">dataframes1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dataframes</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_linear1</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cca&#39;</span><span class="p">]:</span>
            <span class="n">all_combinations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_combinations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">all_fused</span> <span class="o">=</span><span class="p">[]</span>
            <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">df_listn</span> <span class="ow">in</span> <span class="n">all_combinations</span><span class="p">:</span>
                <span class="n">fused_df_t</span> <span class="o">=</span> <span class="n">ccafuse</span><span class="p">(</span><span class="n">df_listn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df_listn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">n_components</span><span class="p">)</span>
                <span class="n">all_fused</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fused_df_t</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_fused</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="s1">&#39;kpca&#39;</span><span class="p">,</span> <span class="s1">&#39;rks&#39;</span><span class="p">,</span> <span class="s1">&#39;SEM&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear1</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;isomap&#39;</span><span class="p">,</span> <span class="s1">&#39;lle&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear2</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1">#print(&quot;done&quot;)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;autoencoder&#39;</span><span class="p">]:</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear3</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                                                <span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> 
                                                <span class="n">hidden_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;plsda&#39;</span><span class="p">]:</span>
            <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#print(merged_df)</span>
            <span class="n">pls_canonical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_pls_model</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pls_canonical</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">merged_df</span><span class="p">),</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PLS</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pls_canonical</span><span class="o">.</span><span class="n">n_components</span><span class="p">)],</span>
                                    <span class="n">index</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> 
            
        <span class="c1">######################</span>
            
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tensordecompose&#39;</span><span class="p">]:</span>
            <span class="n">top_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_features_train</span>
            <span class="n">top_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">top_features</span><span class="p">))</span>
            <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df_list_selected</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">:</span>
                <span class="n">top_feature</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">top_features</span><span class="p">)))</span>
                <span class="n">df_list_selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">top_feature</span><span class="p">])</span>
            <span class="n">all_selected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_list_selected</span><span class="p">)</span>
            <span class="n">fused_df</span> <span class="o">=</span> <span class="n">apply_analysis_nonlinear4</span><span class="p">(</span><span class="n">all_selected</span><span class="p">,</span>
                                                <span class="n">analysis_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
                                                <span class="n">tol</span><span class="o">=</span><span class="mf">10e-6</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fused_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fused_df</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;TD</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fused_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_test</span> <span class="o">=</span> <span class="n">fused_df1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing data is fused. &quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="fusionData.evaluate_fusion_models">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.evaluate_fusion_models">[docs]</a>
    <span class="k">def</span> <span class="nf">evaluate_fusion_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;pca&#39;</span><span class="p">],</span> <span class="n">regression</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate different fusion models on the dataframes and prediction labels. </span>

<span class="sd">        The fusion methods are as follows: </span>

<span class="sd">        - &#39;pca&#39;: Principal Component Analysis</span>
<span class="sd">        - &#39;ica&#39;: Independent Component Analysis</span>
<span class="sd">        - &#39;ipca&#39;: Incremental Principal Component Analysis</span>
<span class="sd">        - &#39;cca&#39;: Canonical Correlation Analysis</span>
<span class="sd">        - &#39;tsne&#39;: t-distributed Stochastic Neighbor Embedding</span>
<span class="sd">        - &#39;kpca&#39;: Kernel Principal Component Analysis</span>
<span class="sd">        - &#39;rks&#39;: Random Kitchen Sinks</span>
<span class="sd">        - &#39;SEM&#39;: Structural Equation Modeling</span>
<span class="sd">        - &#39;autoencoder&#39;: Autoencoder</span>
<span class="sd">        - &#39;tensordecompose&#39;: Tensor Decomposition</span>
<span class="sd">        - &#39;plsda&#39;: Partial Least Squares Discriminant Analysis </span>

<span class="sd">        :param n_components: The number of components use for the fusion. The default is 10.</span>
<span class="sd">        :type n_components: int</span>
<span class="sd">        :param n_folds: The number of folds to use for cross-validation. The default is 10.</span>
<span class="sd">        :type n_folds: int</span>
<span class="sd">        :param methods: A list of fusion methods to apply. The default is [&#39;cca&#39;, &#39;pca&#39;].</span>
<span class="sd">        :type methods: list</span>
<span class="sd">        :param regression: If want to create a regression model. The default is False.</span>
<span class="sd">        :type regression: bool</span>

<span class="sd">        :raises: ValueError if any of the methods are invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
        <span class="n">prediction_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dataframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span>  <span class="o">=</span> <span class="n">save_train_test_data</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">prediction_labels</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;comaprision_data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">regression</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Define a classification of models</span>
            <span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Decision Tree&quot;</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Support Vector Machine&quot;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;Naive Bayes&quot;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())</span>
            <span class="p">]</span>
            <span class="c1"># Initialize a dictionary to store the metrics</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Model type&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;f1 score&quot;</span><span class="p">:[],</span>
                <span class="s2">&quot;Balanced accuracy&quot;</span><span class="p">:[],</span>
                <span class="s2">&quot;MCC&quot;</span><span class="p">:[],</span>
                <span class="s2">&quot;Kappa&quot;</span><span class="p">:[]</span>
            <span class="p">}</span>

            <span class="n">methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="s1">&#39;kpca&#39;</span><span class="p">,</span> <span class="s1">&#39;rks&#39;</span><span class="p">,</span> <span class="s1">&#39;SEM&#39;</span><span class="p">,</span> <span class="s1">&#39;autoencoder&#39;</span><span class="p">,</span> <span class="s1">&#39;tensordecompose&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]</span>
            
            
            <span class="n">valid_methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods_chemdices</span><span class="p">]</span>
            

            <span class="n">invalid_methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods_chemdices</span><span class="p">]</span>
            
            <span class="n">methods_chemdices_text</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">methods_chemdices</span><span class="p">)</span>
            <span class="n">invalid_methods_chemdices_text</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid_methods_chemdices</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_methods_chemdices</span><span class="p">):</span>
                <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;These methods are invalid:</span><span class="si">{</span><span class="n">invalid_methods_chemdices_text</span><span class="si">}</span><span class="se">\n</span>
<span class="s2">                            Valid methods are : </span><span class="si">{</span><span class="n">methods_chemdices_text</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="n">valid_methods_chemdices</span><span class="p">:</span>
                <span class="c1"># Fuse all data in dataframes</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Method name&quot;</span><span class="p">,</span><span class="n">method_chemdice</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTrain</span><span class="p">(</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span><span class="p">,</span>  <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_train</span>
                <span class="n">y_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTest</span><span class="p">(</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span><span class="p">,</span>  <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_test</span>
                <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span>

                <span class="c1"># Loop through the models and evaluate them</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]:</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Non-linear&quot;</span><span class="p">)</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">method_chemdice</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span> <span class="n">name</span> 
                    <span class="c1"># Fit the model on the train set</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
                    <span class="c1"># Predict the probabilities on the test set</span>
                    <span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># Compute the metrics</span>
                    <span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="p">)</span>
                    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">baccuracy</span> <span class="o">=</span> <span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">mcc</span> <span class="o">=</span> <span class="n">matthews_corrcoef</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">kappa</span> <span class="o">=</span> <span class="n">cohen_kappa_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="c1"># Append the metrics to the dictionary</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auc</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Precision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recall</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;f1 score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Balanced accuracy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">baccuracy</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;MCC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mcc</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Kappa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
            <span class="c1"># Convert the dictionary to a dataframe</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;AUC&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Accuracy_metrics</span> <span class="o">=</span> <span class="n">metrics_df</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define a list of regression models</span>
            <span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Linear Regression&quot;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Ridge&quot;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Lasso&quot;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;ElasticNet&quot;</span><span class="p">,</span> <span class="n">ElasticNet</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Decision Tree&quot;</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Gradient Boosting&quot;</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;AdaBoost&quot;</span><span class="p">,</span> <span class="n">AdaBoostRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Support Vector Machine&quot;</span><span class="p">,</span> <span class="n">SVR</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;K Neighbors&quot;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;MLP&quot;</span><span class="p">,</span> <span class="n">MLPRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Gaussian Process&quot;</span><span class="p">,</span> <span class="n">GaussianProcessRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Kernel Ridge&quot;</span><span class="p">,</span> <span class="n">KernelRidge</span><span class="p">())</span>
            <span class="p">]</span>

            <span class="c1"># Initialize a dictionary to store the metrics</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Model type&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;MSE&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;R2 Score&quot;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>

            <span class="n">methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="s1">&#39;kpca&#39;</span><span class="p">,</span> <span class="s1">&#39;rks&#39;</span><span class="p">,</span> <span class="s1">&#39;SEM&#39;</span><span class="p">,</span> <span class="s1">&#39;autoencoder&#39;</span><span class="p">,</span> <span class="s1">&#39;tensordecompose&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="n">methods_chemdices</span><span class="p">:</span>
                <span class="c1"># Fuse all data in dataframes</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Method name&quot;</span><span class="p">,</span> <span class="n">method_chemdice</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTrain</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_train</span>
                <span class="n">y_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTest</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_test</span>
                <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span>

                <span class="c1"># Loop through the models and evaluate them</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]:</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Non-linear&quot;</span><span class="p">)</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">method_chemdice</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="c1"># Fit the model on the train set</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
                    <span class="c1"># Predict on the test set</span>
                    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
                    <span class="c1"># Compute the metrics</span>
                    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                    <span class="c1"># Append the metrics to the dictionary</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;MSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;R2 Score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>

            <span class="c1"># Convert the dictionary to a dataframe</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
            <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;R2 Score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Accuracy_metrics</span> <span class="o">=</span> <span class="n">metrics_df</span></div>



<div class="viewcode-block" id="fusionData.evaluate_fusion_models_nfold">
<a class="viewcode-back" href="../../FeatureDice.html#FeatureDice.fusionData.fusionData.evaluate_fusion_models_nfold">[docs]</a>
    <span class="k">def</span> <span class="nf">evaluate_fusion_models_nfold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cca&#39;</span><span class="p">,</span><span class="s1">&#39;pca&#39;</span><span class="p">],</span><span class="n">regression</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate n-fold cross validations of different fusion models on the dataframes and prediction labels. </span>

<span class="sd">        The fusion methods are as follows: </span>

<span class="sd">        - &#39;pca&#39;: Principal Component Analysis</span>
<span class="sd">        - &#39;ica&#39;: Independent Component Analysis</span>
<span class="sd">        - &#39;ipca&#39;: Incremental Principal Component Analysis</span>
<span class="sd">        - &#39;cca&#39;: Canonical Correlation Analysis</span>
<span class="sd">        - &#39;tsne&#39;: t-distributed Stochastic Neighbor Embedding</span>
<span class="sd">        - &#39;kpca&#39;: Kernel Principal Component Analysis</span>
<span class="sd">        - &#39;rks&#39;: Random Kitchen Sinks</span>
<span class="sd">        - &#39;SEM&#39;: Structural Equation Modeling</span>
<span class="sd">        - &#39;autoencoder&#39;: Autoencoder</span>
<span class="sd">        - &#39;tensordecompose&#39;: Tensor Decomposition</span>
<span class="sd">        - &#39;plsda&#39;: Partial Least Squares Discriminant Analysis </span>

<span class="sd">        :param n_components: The number of components use for the fusion. The default is 10.</span>
<span class="sd">        :type n_components: int</span>
<span class="sd">        :param n_folds: The number of folds to use for cross-validation. The default is 10.</span>
<span class="sd">        :type n_folds: int</span>
<span class="sd">        :param methods: A list of fusion methods to apply. The default is [&#39;cca&#39;, &#39;pca&#39;].</span>
<span class="sd">        :type methods: list</span>
<span class="sd">        :param regression: If want to create a regression model. The default is False.</span>
<span class="sd">        :type regression: bool</span>

<span class="sd">        :raises: ValueError if any of the methods are invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">regression</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Define a list of models</span>
            <span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Logistic Regression&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Decision Tree&quot;</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Support Vector Machine&quot;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;Naive Bayes&quot;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())</span>
            <span class="p">]</span>
            <span class="c1"># Initialize a dictionary to store the metrics</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Model type&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Fold&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;f1 score&quot;</span><span class="p">:[],</span>
                <span class="s2">&quot;Balanced accuracy&quot;</span><span class="p">:[],</span>
                <span class="s2">&quot;MCC&quot;</span><span class="p">:[],</span>
                <span class="s2">&quot;Kappa&quot;</span><span class="p">:[]</span>
            <span class="p">}</span>

            <span class="n">methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="s1">&#39;kpca&#39;</span><span class="p">,</span> <span class="s1">&#39;rks&#39;</span><span class="p">,</span> <span class="s1">&#39;SEM&#39;</span><span class="p">,</span> <span class="s1">&#39;autoencoder&#39;</span><span class="p">,</span> <span class="s1">&#39;tensordecompose&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]</span>
            
            
            <span class="n">valid_methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods_chemdices</span><span class="p">]</span>
            

            <span class="n">invalid_methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods_chemdices</span><span class="p">]</span>
            
            <span class="n">methods_chemdices_text</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">methods_chemdices</span><span class="p">)</span>
            <span class="n">invalid_methods_chemdices_text</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid_methods_chemdices</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_methods_chemdices</span><span class="p">):</span>
                <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;These methods are invalid:</span><span class="si">{</span><span class="n">invalid_methods_chemdices_text</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Valid methods are : </span><span class="si">{</span><span class="n">methods_chemdices_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
            <span class="n">prediction_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_label</span>
            
            <span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_folds</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fold_number</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dataframes</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">])):</span> 

                <span class="bp">self</span><span class="o">.</span><span class="n">train_dataframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dataframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span>  <span class="o">=</span> <span class="n">save_train_test_data_n_fold</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">prediction_labels</span><span class="p">,</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;comaprision_data_fold_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fold_number</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_of_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_folds</span><span class="p">))</span>


                <span class="k">for</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="n">valid_methods_chemdices</span><span class="p">:</span>
                    <span class="c1"># Fuse all data in dataframes</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Method name&quot;</span><span class="p">,</span><span class="n">method_chemdice</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTrain</span><span class="p">(</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span><span class="p">,</span>  <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                    <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_train</span>
                    <span class="n">y_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTest</span><span class="p">(</span><span class="n">n_components</span> <span class="o">=</span> <span class="n">n_components</span><span class="p">,</span>  <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                    <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_test</span>
                    <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span>

                    <span class="c1"># Loop through the models and evaluate them</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]:</span>
                            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Non-linear&quot;</span><span class="p">)</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">method_chemdice</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span> <span class="n">name</span> 
                        <span class="c1"># Fit the model on the train set</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
                        <span class="c1"># Predict the probabilities on the test set</span>
                        <span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="c1"># Compute the metrics</span>
                        <span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span><span class="p">)</span>
                        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">baccuracy</span> <span class="o">=</span> <span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">mcc</span> <span class="o">=</span> <span class="n">matthews_corrcoef</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">kappa</span> <span class="o">=</span> <span class="n">cohen_kappa_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_proba</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
                        <span class="c1"># Append the metrics to the dictionary</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Fold&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fold_number</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auc</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Precision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Recall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recall</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;f1 score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Balanced accuracy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">baccuracy</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;MCC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mcc</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Kappa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
                <span class="c1"># Convert the dictionary to a dataframe</span>
                <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
                <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;AUC&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Accuracy_metrics</span> <span class="o">=</span> <span class="n">metrics_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define a list of regression models</span>
            <span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Linear Regression&quot;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Ridge&quot;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Lasso&quot;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;ElasticNet&quot;</span><span class="p">,</span> <span class="n">ElasticNet</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Decision Tree&quot;</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Gradient Boosting&quot;</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;AdaBoost&quot;</span><span class="p">,</span> <span class="n">AdaBoostRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Support Vector Machine&quot;</span><span class="p">,</span> <span class="n">SVR</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;K Neighbors&quot;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;MLP&quot;</span><span class="p">,</span> <span class="n">MLPRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Gaussian Process&quot;</span><span class="p">,</span> <span class="n">GaussianProcessRegressor</span><span class="p">()),</span>
                <span class="p">(</span><span class="s2">&quot;Kernel Ridge&quot;</span><span class="p">,</span> <span class="n">KernelRidge</span><span class="p">())</span>
            <span class="p">]</span>

            <span class="c1"># Initialize a dictionary to store the metrics</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Model type&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;Fold&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;MSE&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;R2 Score&quot;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>

            <span class="n">methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;tsne&#39;</span><span class="p">,</span> <span class="s1">&#39;kpca&#39;</span><span class="p">,</span> <span class="s1">&#39;rks&#39;</span><span class="p">,</span> <span class="s1">&#39;SEM&#39;</span><span class="p">,</span> <span class="s1">&#39;autoencoder&#39;</span><span class="p">,</span> <span class="s1">&#39;tensordecompose&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]</span>
            
            
            <span class="n">valid_methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods_chemdices</span><span class="p">]</span>
            

            <span class="n">invalid_methods_chemdices</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods_chemdices</span><span class="p">]</span>
            
            <span class="n">methods_chemdices_text</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">methods_chemdices</span><span class="p">)</span>
            <span class="n">invalid_methods_chemdices_text</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid_methods_chemdices</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_methods_chemdices</span><span class="p">):</span>
                <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;These methods are invalid:</span><span class="si">{</span><span class="n">invalid_methods_chemdices_text</span><span class="si">}</span><span class="se">\n</span>
<span class="s2">                            Valid methods are : </span><span class="si">{</span><span class="n">methods_chemdices_text</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">dataframes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframes</span>
            <span class="n">prediction_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_label</span>
            
            <span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_folds</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fold_number</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dataframes</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">])):</span> 

                <span class="bp">self</span><span class="o">.</span><span class="n">train_dataframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dataframes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span>  <span class="o">=</span> <span class="n">save_train_test_data_n_fold</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">prediction_labels</span><span class="p">,</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;comaprision_data_fold_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fold_number</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_of_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_folds</span><span class="p">))</span>


                <span class="k">for</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="n">valid_methods_chemdices</span><span class="p">:</span>
                    <span class="c1"># Fuse all data in dataframes</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Method name&quot;</span><span class="p">,</span> <span class="n">method_chemdice</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTrain</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                    <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_train</span>
                    <span class="n">y_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_label</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fuseFeaturesTest</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method_chemdice</span><span class="p">)</span>
                    <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fusedData_test</span>
                    <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_label</span>

                    <span class="c1"># Loop through the models and evaluate them</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">method_chemdice</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="s1">&#39;ica&#39;</span><span class="p">,</span> <span class="s1">&#39;ipca&#39;</span><span class="p">,</span> <span class="s1">&#39;cca&#39;</span><span class="p">,</span> <span class="s1">&#39;plsda&#39;</span><span class="p">]:</span>
                            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Non-linear&quot;</span><span class="p">)</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">method_chemdice</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">name</span>
                        <span class="c1"># Fit the model on the train set</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
                        <span class="c1"># Predict on the test set</span>
                        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
                        <span class="c1"># Compute the metrics</span>
                        <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                        <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                        <span class="c1"># Append the metrics to the dictionary</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;Fold&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fold_number</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;MSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
                        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;R2 Score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>

                <span class="c1"># Convert the dictionary to a dataframe</span>
                <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
                <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">metrics_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;R2 Score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Accuracy_metrics</span> <span class="o">=</span> <span class="n">metrics_df</span></div>
</div>









<span class="c1">#from sklearn.preprocessing import RobustScaler, QuantileTransformer , PowerTransformer, QuantileTransformer, StandardScaler, MinMaxScaler, normalize</span>




</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Suvendu Kumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>